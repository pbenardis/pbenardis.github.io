{{/*
  Fallback mermaid partial to avoid theme error when `.Store` is not
  available on the page context (some Hugo versions/types expose page
  state differently). This partial intentionally avoids referencing
  `.Store` and is a no-op placeholder so the site can build.
*/}}
{{/*
  Mermaid partial: loads Mermaid and renders any fenced mermaid code
  blocks or `.mermaid` containers on the page. This implementation
  avoids using `.Store` so it's compatible with different Hugo page
  contexts and modules.
*/}}

<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
<script defer>
document.addEventListener('DOMContentLoaded', function () {
  if (typeof mermaid === 'undefined') return;
  try {
    mermaid.initialize({ startOnLoad: false });

    // Convert fenced code blocks (rendered as <pre><code class="language-mermaid">) into .mermaid containers
    document.querySelectorAll('pre > code.language-mermaid, code.language-mermaid').forEach(function (code) {
      var text = code.textContent || '';
      var container = document.createElement('div');
      container.className = 'mermaid';
      container.textContent = text;
      // Replace the outermost pre/code parent if possible
      var outer = code.closest('pre') || code.parentElement;
      outer.parentNode.replaceChild(container, outer);
    });

    // Initialize mermaid on all containers
    mermaid.init(undefined, document.querySelectorAll('.mermaid'));
  } catch (e) {
    console.error('Mermaid init error:', e);
  }
});
</script>
